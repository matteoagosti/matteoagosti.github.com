
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The rationale behind andthewinner.is, a platform for viral contests on Twitter - Matteo Agosti</title>
  <meta name="author" content="Matteo Agosti">

  
  <meta name="description" content="The Rationale Behind andthewinner.is, a Platform for Viral Contests on Twitter Nov 16th, 2012 On November 10-11th 2012 I attended the Node.js &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.matteoagosti.com/blog/2012/11/16/the-rationale-behind-andthewinner-is-a-platform-for-viral-contests-on-twitter/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Matteo Agosti" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2101303-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Matteo Agosti</a></h1>
  
    <h2>Software engineer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.matteoagosti.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">The Rationale Behind andthewinner.is, a Platform for Viral Contests on Twitter</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-16T06:22:00+01:00" pubdate data-updated="true">Nov 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>On November 10-11th 2012 I attended the <a href="http://nodejsconf.it/" title="Node.js conference Italy homepage">Node.js conference</a> in Brescia (Italy) and participated in the hackathon to experiment and have fun with JavaScript on the server side. Together with <a href="https://twitter.com/nickbalestra" title="Nick Balestra's Twitter profile">@nickbalestra</a> we decided to experiment the realtime aspect of Node.js and as we already had background on dealing with social media we decided to build a platform for viral contests on Twitter. We came up with <a href="http://www.andthewinner.is" title="andthewinner.is homepage">andthewinner.is</a> and with this post I&#8217;d like to share the details on how we built it.</p>

<!-- more-->


<p><img src="http://www.matteoagosti.com/images/posts/andthewinneris-homepage-screenshot.png" alt="Screenshot of a andthewinner.is homepage" /></p>

<h2>Introduction</h2>

<p>Before digging into technical details I&#8217;d like to quickly explain the reason why we came up with this project. As <a href="http://feathe.rs/201211111353" title="Nick Balestra's post on the creation of andthewinner.is">Nick mentioned in his post</a> when we attended TechCrunch 2012 event in Rome we were so shocked by the voting done using <a href="http://www.flickr.com/photos/michele_ficara_manganelli/8043905616/in/set-72157631667552679" title="A picture of people voting for startup ideas using pieces of paper at TechCrunch 2012 event in Rome">pieces of paper</a> that we immediately decided to came up with a solution that should be both tech and social.</p>

<p>We started to think about how voting is done in general (written voting, tele voting, etc…) and decided to focus on a public voting system that should be both quick and viral: Twitter! As of late 2011 there are approximately 250 million Tweets and most of them are part of a discussion identified by an hashtag and will likely include a mention to one or more Twitter users. In addition, a Tweet can be also be done via SMS, avoiding 3G/WiFi network issues (many complained about our point for TechCrunch saying that there was no Internet). If this is not an argument strong enough, you just have to look at the recent 2012 US presidential campaign whose result was totally driven by social media. For these reasons we decided to base andthewinner.is on Twitter and leverage on its sharing mechanism to make contests viral.</p>

<p>The general idea is fairly simple: set an #hashtag to identify the contest and use @mention as identifier for contestants. The point of having an hashtag for the contest was introduced to restrict the scope of voting: counting only mentions would simply lead to the top mentioned person overall on Twitter, whereas having an hashtag could actually set up a context. One nice aspect of this approach is that every time a vote is tweeted, anybody tuned on the hashtag will see the vote and could potentially retweet it, thus leading to another vote! In addition, the  tweet text can be anything, it is enough to include the hashtag and one (or even more than one) mention; this means that I can express my vote not just by picking up an option but also attaching a comment to it. This mechanism wouldn&#8217;t probably fit strict rules of political elections, but it could definitely foster promotion of public events, TV programs and so on.</p>

<p>We created a couple of contests to try it out, you can check them out here:</p>

<ul>
<li><a href="http://www.andthewinner.is/nodejsconfit" title="Node.js Conference Speakers contest">Node.js Conference Speakers</a> where conference attendance could vote their favourite speaker.</li>
<li><a href="http://www.andthewinner.is/xf6italia" title="X Factor 2012 Italia Judges contest">X Factor 2012 Italia Judges</a> where X Factor TV program fans could vote their favourite judge.</li>
</ul>


<p>At the moment andthewinner.is is not yet opened to the public in terms of contest creation, but only for contest participation. This has to deal with limitations in the free Twitter API that I am going to analyse later on. However, we are looking forward to run popular contests and if you feel you could have one please contact us via <a href="https://twitter.com/and_thewinneris" title="andthewinner.is' Twitter profile">Twitter</a>.</p>

<h2>Architecture</h2>

<p>When designing the architecture of andthewinner.is we started to think about splitting it into different components as to keep it maintainable and easily scalable. Dealing with Twitter, a potential source for a huge amount of data, means planning ahead something that is dedicated just to it as when traffic grows this could be spread across different machines. We came up with two macro blocks of components: a <em>crawler</em> for fetching tweets and a <em>server app</em> to provide the website experience. A <em>MySQL</em> database is also used for storing contests and votes. Everything has been developed using node.js and relying on the following modules:</p>

<ul>
<li><a href="https://github.com/mikeal/request" title="Homepage of request module for node.js">request</a> so far one of the most complete module for handling HTTP/HTTPS requests with support for OAuth and streams; basically with this module we can handle any request to Twitter</li>
<li><a href="https://github.com/visionmedia/express" title="Homepage of express module for node.js">express</a> the web framework we use for the server app, handling routes, views rendering, etc…</li>
<li><a href="https://github.com/CarnegieLearning/connect-mysql-session" title="Homepage of connect-mysql-session module for node.js">connect-mysql-session</a> a MySQL session store for express</li>
<li><a href="https://github.com/emberfeather/less.js-middleware" title="Homepage of less-middleware module for node.js">less-middleware</a> a LESS middleware for express</li>
<li><a href="https://github.com/donpark/hbs" title="Homepage of hbs module for node.js">hbs</a> a handlebars template engine for express</li>
<li><a href="https://github.com/felixge/node-mysql" title="Homepage of mysql module for node.js">mysql</a> so far the best module (pure JavaScript) to handle MySQL from node.js; the <a href="http://felixge.de/" title="Felix Geisendörfer personal website">author</a> is mad about performances and his talk at the conference just confirmed that this module is the way to go (an old <a href="http://www.youtube.com/watch?v=Kdwwvps4J9A" title="Video of Felix Geisendörfer talking about benchmarking">talk</a> but on the same topic)</li>
<li><a href="https://github.com/LearnBoost/socket.io" title="Homepage of socket.io module for node.js">socket.io</a> handling web sockets from the server point of view</li>
<li><a href="https://github.com/LearnBoost/socket.io-client" title="Homepage of socket.io-client module for node.js">socket.io-client</a> handling web sockets from the client point of view</li>
</ul>


<h3>Crawler</h3>

<p>The crawler is responsible for handling running contests and deal with the setup / processing of Twitter stream.</p>

<p>As the filtering happens on all tweets and is not restricted to an authenticated user&#8217;s timeline, the <a href="https://dev.twitter.com/docs/api/1.1/post/statuses/filter" title="Twitter public stream API documentation">public stream API</a> has been chosen as the only viable option. However, there are some limitations to bear in mind</p>

<ul>
<li>The number of messages sent to the client is limited to a very small fraction of the total volume of tweets (firehose). If there are more tweets that would match the criteria, they&#8217;ll get discarded.</li>
<li>The stream can be filtered with up to 400 keywords, 5000 mentions, 25 location boxes.</li>
<li>In theory no more than one connection per IP is allowed, even though we went stable up to 11 connections (but this is likely to get banned!). If you try to open two connections to the stream for the same authenticated user the oldest one will get closed, however multiple streams for different users works well (again, until you get banned!).</li>
</ul>


<p>Obviously for the hackathon we could cope with these limitations, but in a real scenario you are forced to switch to <a href="https://dev.twitter.com/programs/twitter-certified-products/products" title="Twitter certified products page">Twitter certified data resellers</a>. That is the main reason why we are not yet opening andthewinner.is to the public.</p>

<p>The logic behind the crawler is fairly simple: it opens a single connection to the stream API using an internal authenticated user and wraps all hashtags into a comma separated values query. Resulting tweets are then processed to find out the related contest and matching participants. This would potentially allow for 400 simultaneously running contests, but depending on their &#8220;popularity&#8221; the stream cap could be reached quite rapidly. So far, we tested it out with popular hashtags and haven&#8217;t reached the cap yet.</p>

<p>Every time a new vote is matched, the database gets updated by increasing contest counters; we decided not to store the originating tweet, but that could be easily done and used for some sort of restrictions (e.g. max number of tweets from the same user) or for statistics (e.g. geo distribution of voters). In any case, when dealing with Twitter contents, it is important to know that if you store data you can&#8217;t display them publicly, but only in a private dashboard.</p>

<p>As to prevent polling the database to find out when a new vote is counted, the crawler provides a socket access to the server app and broadcast the contest data whenever a new update occurs.</p>

<h3>Server app</h3>

<p>The server app is responsible for providing the overall website experience. It is built as an express application and relies on handlebars for rendering page layouts. Page styling is done using a LESS file that is compiled every time the app is started and it includes a responsive layout for a better mobile experience. When the server app is started, it immediately connects to the crawler waiting for contest updates. In addition, it creates a server socket for updating connected clients on specific contest updates; for every contest, in fact,  a channel is created and only its related votes are broadcasted.</p>

<p>Whenever a contest page is requested, the database is queried for fetching data, the handlebars template is compiled and the full page is sent to the client browser; until this point it is not necessary to have support for JavaScript on the client and this allows for fast rendering on mobile devices.</p>

<p>Immediately after the page is loaded the client opens a socket connection with the server app by tuning on the contest channel, thus receiving updates only for the requested contest.</p>

<p>So far everything is pretty standard, there is however a technical solution that in my opinion is worth mentioning as it proves how effective it is to work with JavaScript on both server and client side.</p>

<p>The socket communication exchanges JSON data, so every time a contest receives a vote, a JSON representation of contest and participants is sent to the client. This data structure is normalised from the server as to prevent calculations on the client side; what the server does is basically sorting out rankings, find out if there are ties and so on. As we had mobile devices in mind, we wanted to minimise the time needed for calculus and if you think about contests with a rate of 10 votes per second, unless you rate limit the updates on socket, this would lead to an unusable page. So, the first point of contest normalisation is solved on the server, but what about page rendering on the client? The trick here was to rely on handlebars on the client side too: we precompiled the template we use on the server side (yes, exactly the same template!) as to speed up any operation on the client, and whenever a new update is sent over socket the template is applied to the data structure and the contest HTML replaced with the new one. This gave us an amazing result as we could easily handle 10 votes per second on a mobile device, whereas with the standard solution of processing JSON and rendering the page we could reach a max of 2.7 votes per second.</p>

<p>To sum up, the server app provides a mechanism for normalising contests and the resulting JSON structure is used for compiling the same handlebars file on both server and client. Access to the database is done only on page reload whereas in page updates are done using per-contest channeled socket communication. Did I say already that everything is done in JavaScript? Isn&#8217;t that awesome? :-)</p>

<h2>Conclusions</h2>

<p>With this post I tried to explain the overall architecture of andthewinner.is, a platform for creating viral contests on Twitter. It is an hackathon project whose goal was to play with node.js and realtime communication; despite being a 24 hours coding / designing result, a lot of efforts went in the overall concept and we strongly believe it has a remarkable growing potential. Our goal was also to show the unexplored capabilities of social media platforms and, in some way, to tease traditional voting systems that in our opinion are not effective and viral.</p>

<p>Due to limitations of free APIs the platform is opened only for the voting part, this means that if you want to try out a contest you&#8217;ll have to <a href="mailto:andthewinner.is@beyounic.com" title="Email address of andthewinner.is team">contact us</a>; however, by subscribing commercial data plans any limitation could be bypassed.</p>
</div>



  <p>If you want to discuss about this article, I'm <a href="https://twitter.com/matteoagosti" title="Contact me on Twitter" rel="nofollow">@matteoagosti on Twitter</a>.
    
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Matteo Agosti</span></span>

      








  


<time datetime="2012-11-16T06:22:00+01:00" pubdate data-updated="true">Nov 16<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>Development</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.matteoagosti.com/blog/2012/11/16/the-rationale-behind-andthewinner-is-a-platform-for-viral-contests-on-twitter/" data-via="matteoagosti" data-counturl="http://www.matteoagosti.com/blog/2012/11/16/the-rationale-behind-andthewinner-is-a-platform-for-viral-contests-on-twitter/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/10/28/automatic-screen-shot-sharing-with-dropbox-and-automator/" title="Previous Post: Automatic screen shot sharing with Dropbox and Automator">&laquo; Automatic screen shot sharing with Dropbox and Automator</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/01/17/drupal-website-development-using-a-git-workflow/" title="Next Post: Drupal website development using a GIT workflow">Drupal website development using a GIT workflow &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/02/24/writing-javascript-modules-for-both-browser-and-node/">Writing JavaScript modules for both Browser and Node.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/22/rate-limiting-function-calls-in-javascript/">Rate limiting function calls in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/17/drupal-website-development-using-a-git-workflow/">Drupal website development using a GIT workflow</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/16/the-rationale-behind-andthewinner-is-a-platform-for-viral-contests-on-twitter/">The rationale behind andthewinner.is, a platform for viral contests on Twitter</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/28/automatic-screen-shot-sharing-with-dropbox-and-automator/">Automatic screen shot sharing with Dropbox and Automator</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("matteoagosti", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/matteoagosti" class="twitter-follow-button" data-show-count="false">Follow @matteoagosti</a>
  
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/100338091555197609658?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Matteo Agosti -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
